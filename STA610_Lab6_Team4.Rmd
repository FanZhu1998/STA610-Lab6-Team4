---
title: \vspace{-1.5cm} \textbf{STA610 Lab 6 Team 4 Report}
author:
- Cole Juracek 
- Lauren Palazzo 
- Lingyu Zhou 
- Fan Zhu
date: "`r Sys.Date()`"
output:
  pdf_document: default
fontsize: 11pt
geometry: margin=2cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, fig.height = 3)
```

```{r}
df <- read.delim("BadgersFarmSurveysNoNA.txt", header = TRUE)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(pacman)
pacman::p_load(tidyverse, lme4, gridExtra, grid, ggplot2, lattice, redres, stringr, influence.ME, knitr)
# devtools::install_github("goodekat/redres")
```

## EDA

#### Response Variable: Signs_in_yard
```{r}
knitr::kable(table(df$Signs_in_yard), 
             col.names = c("Signs in Yard","Freq"), 
             caption = "Frequency Table for Signs in Yard")
```


```{r}
table(df$Year)
```

```{r}
table(df$Season)
```


```{r}
hist(df$No_active_setts_in_fields)
```

```{r}
hist(df$No_cattle_in_buidlings_yard)
```

```{r}
table(df$Accessible_feed_store_present)
```

## Cole EDA (remaining variables)

```{r}
# For visualization, it helps to make these variables factors
df[, 11:21] <- apply(df[, 11:21], 2, factor)
```

First, we want to check the relative proportion of badger activity for each binary variable:

```{r fig.height=5}
plot_binary_data <- function(data, col) {
    var_df <- data %>% group_by_at(col) %>% summarise(prop = sum(Signs_in_yard) / n())
    ggplot(var_df, aes_string(x=col, y='prop', fill=col)) + geom_col() + ylim(0, 1) + theme(legend.position = "none")
}

binary_plots <- lapply(names(df)[11:21], plot_binary_data, data=df)
grid.arrange(grobs=binary_plots, ncol = 4)
```

Nearly all of the proportions look like they *could* be similar - especially due to the small sample size. We can formally test whether the proportions are different with a Chi-square test:

```{r}
test_proportion <- function(col) {
    results <- chisq.test(table(df$Signs_in_yard, df[, col]))
    return(results$p.value)
}
```

```{r}
good_ss_names <- c(11:17, 21)
results <- sapply(names(df)[good_ss_names], test_proportion)
kable(data.frame('p-val' = results), digits = 3)
```

At a significance level of $\alpha = 0.05$, we reject the null hypotheses for the following

- HayStraw
- Concentrates
- Molasses

And conclude their proportions are not equal.

For the remaining variables, the assumptions of a Chi-sq test were violated (Proteinblocks, Sugarbeet, and Vegetables). At least one of the table values has an expected counts < 5. We can test these with a Fisher exact test for small sample sizes:

```{r}
results <- sapply(c('Proteinblocks', 'Sugarbeet', 'Vegetables'), function(col) {
    results <- fisher.test(table(df$Signs_in_yard, df[, col]))
    return(results$p.value)
})
kable(data.frame('p-val' = results), digits = 3)
```

The results of the Fisher test suggest we should not reject the null at the standard significance level. We do not conclude a meaningful association between these variables and the response.

## Model

Predictors to consider include year, season, number of active badger homes in nearby fields (no_active_setts_in_fields), the number of cattle on the farm (no_cattle_in_buildings_yard), whether farm feed can be accessed by badgers (accessible_feed_store_present), and indicators of whether various types of crops were present on the farm (including grass silage, cereal silage, hay, cereal for grain, sugar beets, vegetables, and molasses).

```{r}
mdl1 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + Accessible_feed_store_present + (1|Season) + Grass_silage + Cereal_silage + HayStraw + Cereal_grains + Sugarbeet + Vegetables + Molasses, 
              family = binomial(link="logit"),
              data = df)
summary(mdl1)

```


#### Model Specification

## Result
