---
title: \vspace{-1.5cm} \textbf{STA610 Lab 6 Team 4 Report}
author:
- Cole Juracek 
- Lauren Palazzo 
- Lingyu Zhou 
- Fan Zhu
date: "`r Sys.Date()`"
output:
  pdf_document: default
fontsize: 11pt
geometry: margin=2cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, fig.height = 3)
```

```{r}
df <- read.delim("BadgersFarmSurveysNoNA.txt", header = TRUE)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(pacman)
pacman::p_load(tidyverse, lme4, gridExtra, grid, ggplot2, lattice, redres, stringr, influence.ME, knitr, GGally, corrplot)
# devtools::install_github("goodekat/redres")
```

## EDA
#### Response Variable: Signs_in_yard
```{r}
df$Signs_in_yard = factor(df$Signs_in_yard)
knitr::kable(table(df$Signs_in_yard), 
             col.names = c("Signs in Yard","Freq"), 
             caption = "Frequency Table for Signs in Yard")
```

#### Year & Season
```{r, fig.height=2, fig.align='center', include=FALSE}
df$Year = factor(df$Year)
df$Season = factor(df$Season)

bar_year <- ggplot(df, 
       aes(x = Year, 
           group = Signs_in_yard,
           fill = Signs_in_yard)) + 
  geom_bar(position = "dodge")

bar_season <- ggplot(df, 
       aes(x = Season, 
           group = Signs_in_yard,
           fill = Signs_in_yard)) + 
  geom_bar(position = "dodge")

grid.arrange(bar_year, bar_season, ncol=2)
```
```{r, fig.align='center', fig.height=2}
bar_year <- ggplot(df, 
       aes(x = Year, 
           fill = Signs_in_yard)) + 
  geom_bar(position = "fill") +
  labs(y = "Proportion")


bar_season <- ggplot(df, 
       aes(x = Season, 
           fill = Signs_in_yard)) + 
  geom_bar(position = "fill") +
  labs(y = "Proportion")

grid.arrange(bar_year, bar_season, ncol=2)
```


From the bar plot of Signs_in_yard by Year we can observe that the presence of badger activity in the farmyard in 2004 is lower than those in 2003 and 2005. From the bar plot of Signs_in_yard by Season we see that presence of badger activity is the highest in season 1 and the lowest in season 3.

#### No_active_setts_in_fields & No_cattle_in_buidlings_yard
```{r, fig.height=2, fig.align='center', include=FALSE}
hist_No_active_setts_in_fields <- ggplot(df, aes(x=No_active_setts_in_fields)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white", bins = 20)+
 geom_density(alpha=.2, fill="red") 

hist_No_cattle_in_buidlings_yard <- ggplot(df, aes(x=No_cattle_in_buidlings_yard)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white", bins = 20)+
 geom_density(alpha=.2, fill="blue") 

grid.arrange(hist_No_active_setts_in_fields,hist_No_cattle_in_buidlings_yard, ncol=2)

# Both the distributions of No_active_setts_in_fields and No_cattle_in_buidlings_yard are extremely right skewed. 
```

```{r, fig.align='center', fig.height=2}
box_No_active_setts_in_fields <- ggplot(data=df, 
       mapping = aes(x = Signs_in_yard, 
                     y = No_active_setts_in_fields, 
                     fill = Signs_in_yard)) + 
  geom_boxplot()

box_No_cattle_in_buidlings_yard <- ggplot(data=df, 
       mapping = aes(x = Signs_in_yard, 
                     y = No_cattle_in_buidlings_yard, 
                     fill = Signs_in_yard)) + 
  geom_boxplot()

grid.arrange(box_No_active_setts_in_fields, 
             box_No_cattle_in_buidlings_yard, 
             ncol=2)
```
The median of No_active_setts_in_fields is much higher when there is badger activity in the farmyard than when there is no badger activity. The median of No_cattle_in_buidlings_yard is also much higher when there is badger activity in the farmyard than when there is no badger activity. 

#### Farm
```{r, fig.align='center', fig.height=2.5}
df$Accessible_feed_store_present = factor(df$Accessible_feed_store_present)

bar_farm <- ggplot(df, 
       aes(x = farm_code_numeric, 
           fill = Signs_in_yard)) + 
  geom_bar(position = "stack") + 
  labs(title = "Signs in Yard by Farm")

bar_Accessible_feed_store_present <- ggplot(df, 
       aes(x = Accessible_feed_store_present, 
           fill = Signs_in_yard)) + 
  geom_bar(position = "fill") +
  labs(y = "Proportion",
       title = "Accessible_feed_store_present")

grid.arrange(bar_farm, bar_Accessible_feed_store_present, 
             ncol=2,
             widths=c(3, 2))
```
The patterns in the stacked bar chart of Signs_in_yard by farm indicate the incorporation of the random intercept by farm into our model. From the segmented bar chart for Accessible_feed_store_present we know that there are more presences of badger activities in the farmyard when there is Accessible_feed_store_present than when there is not. 

#### Binary Variables

```{r, fig.align='center', fig.height=3}
corrplot(cor(df[,c(13,14,15,16,19,20,21)]), 
         method = "color", 
         addCoef.col="grey", 
         order = "AOE",
         number.cex = 0.75,
         tl.cex = 0.5)
```


```{r}
correlation::correlation(df[,c(10,13,14,15,16,19,20,21)])
```


```{r}
table(df$Accessible_feed_store_present)
```




## Model

Predictors to consider include year, season, number of active badger homes in nearby fields (no_active_setts_in_fields), the number of cattle on the farm (no_cattle_in_buildings_yard), whether farm feed can be accessed by badgers (accessible_feed_store_present), and indicators of whether various types of crops were present on the farm (including grass silage, cereal silage, hay, cereal for grain, sugar beets, vegetables, and molasses).

```{r}
mdl1 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + Accessible_feed_store_present + (1|Season) + Grass_silage + Cereal_silage + HayStraw + Cereal_grains + Sugarbeet + Vegetables + Molasses, 
              family = binomial(link="logit"),
              data = df)
#summary(mdl1)

mdl2 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric), 
              family = binomial(link="logit"),
              data = df)

mdl3 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric) + Season, 
              family = binomial(link="logit"),
              data = df)

mdl4 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric) + Season  + HayStraw  , 
              family = binomial(link="logit"),
              data = df)

mdl5 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric) + Season  + Sugarbeet, 
              family = binomial(link="logit"),
              data = df)

mdl6 <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric) + Season  + Molasses, 
              family = binomial(link="logit"),
              data = df)

anova(mdl4,mdl5,mdl6)

```

```{r}
mdl_final <- glmer(Signs_in_yard ~ No_active_setts_in_fields + No_cattle_in_buidlings_yard + (1|farm_code_numeric) + Season  + HayStraw  , 
              family = binomial(link="logit"),
              data = df)
```


#### Model Specification

## Result
